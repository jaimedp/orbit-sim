(function () {
'use strict';

var classCallCheck = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};

var createClass = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();

var Universe = function () {
  function Universe(bodies) {
    classCallCheck(this, Universe);

    this.bodies = bodies;
    this.dt = 24 * 3600 * 7;
  }

  createClass(Universe, [{
    key: "step",
    value: function step() {
      var _this = this;

      // calculate all the forces
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = this.bodies[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var body = _step.value;
          var _iteratorNormalCompletion2 = true;
          var _didIteratorError2 = false;
          var _iteratorError2 = undefined;

          try {
            for (var _iterator2 = this.bodies[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
              var other = _step2.value;

              if (body === other) {
                continue;
              }

              var _body$computeAttracti = body.computeAttraction(other),
                  fx = _body$computeAttracti.fx,
                  fy = _body$computeAttracti.fy;

              body.addForce(fx, fy);
            }
          } catch (err) {
            _didIteratorError2 = true;
            _iteratorError2 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion2 && _iterator2.return) {
                _iterator2.return();
              }
            } finally {
              if (_didIteratorError2) {
                throw _iteratorError2;
              }
            }
          }
        }

        // integrate new position for all bodies
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }

      this.bodies.forEach(function (b) {
        return b.integrate(_this.dt);
      });
    }
  }, {
    key: "render",
    value: function render(ctx, toScreen) {
      // render new pos
      this.bodies.forEach(function (b) {
        return b.render(ctx, toScreen);
      });
    }
  }]);
  return Universe;
}();

var G = 6.67428e-11;

var defaultOptions = Object.freeze({
  color: '#f00'
});

var Body = function () {
  function Body() {
    var mass = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
    var name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'Body';
    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
    classCallCheck(this, Body);

    this.name = name;
    this.mass = mass;
    this.options = Object.assign({}, defaultOptions, options);

    this.rad = 5;

    this.x = this.options.x || 0;
    this.y = this.options.y || 0;
    this.vx = this.options.vx || 0;
    this.vy = this.options.vy || 0;

    this.forces = { x: 0, y: 0 };
  }

  createClass(Body, [{
    key: 'computeAttraction',
    value: function computeAttraction(other) {
      var dx = other.x - this.x;
      var dy = other.y - this.y;

      var d2 = dx * dx + dy * dy;

      if (d2 === 0) {
        throw new Error('coliision!');
      }

      var f = G * this.mass * other.mass / d2;
      var t = Math.atan2(dy, dx);

      return {
        fx: Math.cos(t) * f,
        fy: Math.sin(t) * f
      };
    }
  }, {
    key: 'addForce',
    value: function addForce(fx, fy) {
      this.forces.x += fx;
      this.forces.y += fx;
    }
  }, {
    key: 'integrate',
    value: function integrate(dt) {
      var fx = this.forces.x;
      var fy = this.forces.y;

      var v0x = this.vx;
      var v0y = this.vy;

      this.vx += fx / this.mass * dt;
      this.vy += fy / this.mass * dt;

      this.x += (v0x + this.vx) * 0.5 * dt;
      this.y += (v0y + this.vy) * 0.5 * dt;

      this.forces.x = 0;
      this.forces.y = 0;
    }
  }, {
    key: 'render',
    value: function render(ctx, toScreen) {
      var _toScreen = toScreen(this.x, this.y),
          x = _toScreen.x,
          y = _toScreen.y;

      ctx.beginPath();
      ctx.arc(x, y, this.rad, 0, 2 * Math.PI, false);
      ctx.fillStyle = this.options.color;
      ctx.fill();
    }
  }]);
  return Body;
}();

var AU = 149.6e6 * 1000;
var SCALE = 50 / AU;

var b1 = new Body(1.98892 * Math.pow(10, 32), 'sun', { color: 'yellow' });
var b2 = new Body(5.9742 * Math.pow(10, 24), 'earth', { color: 'blue', x: -1 * AU, vy: 29.783 * 1000 });
var b3 = new Body(4.8685 * Math.pow(10, 24), 'venus', { color: 'red', x: 0.723 * AU, vy: -35.02 * 1000 });

var universe = new Universe([b1, b2, b3]);

var canvas = document.getElementById('myCanvas');
var context = canvas.getContext('2d');
var centerX = canvas.width / 2;
var centerY = canvas.height / 2;

var toScreen = function toScreen(x, y) {
  return { x: x * SCALE + centerX, y: centerY + y * SCALE };
};
var btn = document.getElementById('step');

universe.render(context, toScreen);

btn.addEventListener('click', function () {
  universe.step();
  context.clearRect(0, 0, canvas.width, canvas.height);
  universe.render(context, toScreen);
});

}());
//# sourceMappingURL=main.min.js.map
